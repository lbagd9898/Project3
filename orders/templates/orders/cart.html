<html>
<head>
  <title>Your Cart!</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <style>
        .items{
          padding: 1%;
          border-bottom: 1px solid black;
          border-top: 1px solid black;
          font-size: 150%;
          z-index: 3
        }
        #total{
          font-size: 150%;
          color: black;
          padding: 1%;
        }
        #footer {
          position: fixed;
          z-index: 6;
          bottom: 0;
          width: 100%;
        }
        #footer-container{
          background-color: #D3D3D3
        }
        .footer-btns{
          font-size: 20px;
          padding: 15px;
        }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script>
  $(document).ready(function() {
    if({{ total }} == 0){
      $("#checkout-button").prop("disabled", true);
      console.log('abled');
    }
    else {
      $("#checkout-button").prop("disabled", false);
      console.log('disabled');
    }
});
  </script>
</head>
<body>
    <header class="d-flex p-2 justify-content-center">
      <h1 class-"text-center">My Order</h1>
    </header>
    <div class="container">
      {% if messages %}
      <ul class="messages">
          {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
      </ul>
      {% endif %}
      {% if cart_items %}
      {% for item in cart_items %}
      <div class="d-flex flex-row justify-content-between items">
      <div> {{ item }} </div> <a href="{% url 'delete_item' item.id %}" class="btn btn-primary">Delete Item</a>
    </div>
      {% endfor %}
      {% else %}
      <div class="d-flex flex-row justify-content-center items">
      <div> Your cart is Empty! Return to Menu to add items to your cart! </div>
    </div>
    {% endif %}
  </div>
  <footer id="footer">
    <div class="container" id="footer-container">
      <div class="d-flex flex-row justify-content-between" id="total">
      <div> Total: </div> <div> ${{ total }} </div>
    </div>
      <div class="d-flex flex-row justify-content-between items">
         <a href="{% url 'index' %}" class="btn btn-secondary footer-btns">Return to Menu</a>
         <button id="checkout-button" class="btn btn-primary footer-btns" type="button">Place Order</button>
      </div>
    </div>
  </footer>
  <script src="https://js.stripe.com/v3/"></script>
  <script type="text/javascript">
      // Create an instance of the Stripe object with your publishable API key

      const checkoutbutton = document.querySelector('#checkout-button');

      checkoutbutton.addEventListener('click', function() {
        fetch('/checkout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/JSON'
          },
          body: JSON.stringify({
            amount: {{ total }},
            qunatity: 1
          })
        })
        .then((result) => { return result.json() })
        .then((data) => {
          var stripe = Stripe(data.stripe_public_key);

          stripe.redirectToCheckout({
            sessionId: data.session_id
          })
        .then(function(result) {
          // If `redirectToCheckout` fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using `error.message`.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function(error) {
          console.error('Error:', error);
        });
      });
    });
    </script>
</body>
</html>
